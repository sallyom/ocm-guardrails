# ClusterSPIFFEID for OpenClaw A2A workloads
#
# Registers pods labeled kagenti.io/type=agent in namespaces labeled
# agentcard=true with SPIRE, issuing SPIFFE IDs of the form:
#   spiffe://<trust-domain>/ns/<namespace>/sa/<service-account>
#
# The SPIRE controller manager watches this CR and automatically creates
# SPIRE registration entries for matching pods.
apiVersion: spire.spiffe.io/v1alpha1
kind: ClusterSPIFFEID
metadata:
  name: agentcard-agents
spec:
  namespaceSelector:
    matchLabels:
      agentcard: "true"
  podSelector:
    matchLabels:
      kagenti.io/type: agent
  spiffeIDTemplate: "spiffe://{{ .TrustDomain }}/ns/{{ .PodMeta.Namespace }}/sa/{{ .PodSpec.ServiceAccountName }}"
